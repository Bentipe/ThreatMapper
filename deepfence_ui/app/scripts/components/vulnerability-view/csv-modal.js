import React, { useEffect } from 'react';
import { connect } from 'react-redux';
import CSVForm from './csv-form';
import Loader from '../loader';
import {
  getNodeTagsAction,
  vulnerabilityCSVDownloadAction,
} from '../../actions/app-actions';

const CSVModal = props => {
  useEffect(() => {
    getNodeTags();
  }, []);

  const handleDownloadCSV = valuesIm => {
    const { vulnerabilityCSVDownloadAction: action } = props;
    const values = valuesIm.toJS();
    action(values);
  };

  const getNodeTags = () => {
    const { getNodeTagsAction: action } = props;
    return action();
  };

  const { nodeTags, loading } = props;
  return (
    <div>
      {loading && (
        <div className="loader">
          <Loader small style={{ left: '50%', top: '50%' }} />
        </div>
      )}
      <CSVForm
        onSubmit={(valuesIm) => handleDownloadCSV(valuesIm)}
        nodeTags={nodeTags}
      />
    </div>
  );
};

const mapStateToProps = state => ({
  nodeTags: state.get('node_tags'),
  loading: state.getIn(['report_download', 'cve', 'loading']),
});

export default connect(mapStateToProps, {
  getNodeTagsAction,
  vulnerabilityCSVDownloadAction,
})(CSVModal);
