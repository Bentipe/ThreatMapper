/*eslint-disable*/
import React from 'react';
import { useDispatch } from 'react-redux';
import BubbleChart from '../common/charts/bubble-chart/index';
import { setSearchQuery } from '../../actions/app-actions';
import { constructGlobalSearchQuery } from '../../utils/search-utils';

const TopExploitableSeverityReport = props => {
  const dispatch = useDispatch();

  const sectionClickHandler = point => {
    const { globalSearchQuery: existingQuery = [] } = props;
    const pointSplit = point.split('/');

    let searchQuery = [];
    if (pointSplit[0]) {
      const severityParams = {
        cve_severity: pointSplit[0],
      };
      searchQuery = constructGlobalSearchQuery(existingQuery, severityParams);
    }

    if (pointSplit[1]) {
      const imageParams = {
        cve_container_image: pointSplit[1],
      };
      searchQuery = constructGlobalSearchQuery(searchQuery, imageParams);
    }

    const globalSearchQuery = {
      searchQuery,
    };
    dispatch(setSearchQuery(globalSearchQuery));
  };

  const { data = [] } = props;
  const emptyData = data.length === 0;
  const showChart = !emptyData;
  return (
    <div className="relative">
      {showChart && (
        <BubbleChart
          data={data}
          name="top-exploitable-severity-report"
          onSectionClick={point => sectionClickHandler(point)}
          chartHeight={600}
          chartWidth={580}
        />
      )}
      <br />
    </div>
  );
};

export default TopExploitableSeverityReport;
